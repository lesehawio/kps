<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KeePrice — فروشگاه مدرن</title>
<style>
:root{
  --bg:#f0f4f8;
  --card:#ffffff;
  --accent:#0b3d91;
  --accent2:#b7410e;
  --muted:#d0d0d0;
  --text:#111;
}
body{font-family:Tahoma,Arial, sans-serif;direction:rtl;background:var(--bg);margin:0;color:var(--text)}
header{background:linear-gradient(90deg,var(--accent) 0%,#6b9ddb 100%);color:#fff;padding:16px 20px;display:flex;align-items:center;gap:12px}
header h1{margin:0;font-size:20px;font-weight:600}
.container{display:grid;grid-template-columns:1fr 380px;gap:18px;padding:18px}
.card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
.toolbar{display:flex;gap:10px;align-items:center;margin-bottom:16px;flex-wrap:wrap}
input,select,button{font-family:inherit}
input,select{padding:6px 10px;border-radius:6px;border:1px solid #ccc}
button{cursor:pointer}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
.product-card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 4px 12px rgba(0,0,0,0.05);transition:0.2s}
.product-card:hover{box-shadow:0 6px 18px rgba(0,0,0,0.12);transform:translateY(-2px)}
.product-name{font-weight:600;margin:6px 0}
.product-brand{color:var(--muted);font-size:13px}
.product-category{font-size:12px;color:#999}
.price{font-weight:700;color:var(--accent2);margin:8px 0}
.btn{background:var(--accent);color:#fff;border:none;padding:6px 10px;border-radius:6px;transition:0.2s}
.btn:hover{background:var(--accent2)}
.btn.small{padding:4px 8px;font-size:13px}
.cart-list{max-height:420px;overflow:auto}
.cart-row{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #eee}
.total{font-size:18px;font-weight:800;margin-top:12px;color:var(--accent2)}
.sidebar{position:sticky;top:18px;height:fit-content}
.muted{color:var(--muted);font-size:12px}
@media(max-width:920px){.container{grid-template-columns:1fr;padding:12px}.sidebar{position:static}}
</style>
</head>
<body>
<header>
<div style="width:44px;height:44px;border-radius:8px;overflow:hidden">
  <img src="https://uploadkon.ir/uploads/76bd07_25photo-2025-10-06-18-29-38-removebg-preview.png" alt="Logo" style="width:100%;height:100%;object-fit:cover">
</div>

  <div>
    <h1>KeePrice — فروشگاه مدرن</h1>
    <div class="muted">انتخاب کالا → نوع قیمت → افزودن به سبد</div>
  </div>
</header>

<div class="container">
  <main class="card">
    <div class="toolbar">
      <input id="q" placeholder="جستجو نام یا برند">
      <select id="filterCat"><option value="">همه دسته‌ها</option></select>
      <select id="priceType">
        <option value="partner">قیمت همکار</option>
        <option value="customer">قیمت مشتری</option>
      </select>
      <button class="btn small" id="clearBtn">پاک‌سازی</button>
    </div>

    <div class="products-grid" id="productsArea"></div>
  </main>

  <aside class="sidebar">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><strong>سبد خرید</strong><div class="muted">آیتم‌های انتخاب‌شده</div></div>
        <div class="tag" style="background:var(--accent2);color:#fff;padding:4px 8px;border-radius:999px;font-size:12px;">KeePrice</div>
      </div>
      <div class="cart-list" id="cartList"></div>
      <div class="total" id="total">جمع کل: 0 تومان</div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" id="printBtn">چاپ / پیش‌نمایش فاکتور</button>
        <button class="btn small" id="clearCart">پاک کردن</button>
      </div>
    </div>
  </aside>
</div>

<script>
(function(){
let products=[], cart=[];

function fmt(n){ return Number(n).toLocaleString('fa-IR') + ' تومان'; }
function byId(id){ return document.getElementById(id); }

// تمام محصولات با قیمت همکار
const rawProducts=[
{SKU:'IR-AMP-2',category:'آداپتور',name:'ایرانی آمپر ۲',partner:950000},
{SKU:'2A-VOLT',category:'آداپتور',name:'۲ آمپر ولت',partner:1250000},
{SKU:'5A-LAP',category:'آداپتور',name:'لپتابی آمپر ۵',partner:2450000},
{SKU:'5A-IND',category:'آداپتور',name:'صنعتی آمپر ۵',partner:3100000},
{SKU:'10A-IND',category:'آداپتور',name:'صنعتی امیر ۱۰',partner:4800000},
{SKU:'15A-IND',category:'آداپتور',name:'صنعتی امیر ۱۵',partner:5400000},
{SKU:'20A-IND',category:'آداپتور',name:'صنعتی آمپر ۲۰',partner:6200000},
{SKU:'30A-IND',category:'آداپتور',name:'صنعتی آمپر ۳۰',partner:7000000}, 
{SKU:'K07-64',category:'کابل ترکیبی',name:'کابل ۰۷/۶۴',partner:90000},
{SKU:'K07-96-CCA',category:'کابل ترکیبی',name:'کابل 07/96 cca',partner:155000},
{SKU:'K07-96-CU',category:'کابل ترکیبی',name:'کابل 07/96 مس',partner:185000},
{SKU:'K08-96-CCA',category:'کابل ترکیبی',name:'کابل 08/96 cca',partner:135000},
{SKU:'UTP-CU',category:'شبکه',name:'کابل UTP CU 305M',partner:215000},
{SKU:'UTP-CCA',category:'شبکه',name:'کابل UTP CCA 305M',partner:135000},
{SKU:'SFTP-CU',category:'شبکه',name:'کابل SFTP CU 500M',partner:265000},
{SKU:'SFTP-CCA',category:'شبکه',name:'کابل SFTP CCA 500M',partner:160000},
{SKU:'HDMI-1.5M',category:'HDMI',name:'HDMI 1/5M',partner:1200000},
{SKU:'HDMI-3M',category:'HDMI',name:'HDMI 3M',partner:1800000},
{SKU:'HDMI-SM',category:'HDMI',name:'HDMI SM',partner:4800000},
{SKU:'HDMI-10M',category:'HDMI',name:'HDMI 10M',partner:6500000},
{SKU:'VGA-1.5M',category:'VGA',name:'VGA 1/5M',partner:650000},
{SKU:'VGA-3M',category:'VGA',name:'VGA 3M',partner:1200000},
{SKU:'USB-1.5M',category:'USB',name:'USB 1/5M',partner:850000},
{SKU:'BCHK-1',category:'بچکرد',name:'۱ بچکرد',partner:450000},
{SKU:'FLEX-11',category:'فلکسی',name:'۱۱ نمره فلکسی',partner:192000},
{SKU:'FLEX-13',category:'فلکسی',name:'۱۳ نمره فلکسی',partner:214000},
{SKU:'FLEX-16',category:'فلکسی',name:'۱۶ نمره فلکسی',partner:323200},
{SKU:'FLEX-21',category:'فلکسی',name:'۲۱ نمره فلکسی',partner:466200},
{SKU:'FLEX-25',category:'فلکسی',name:'۲۵ نمره فلکسی',partner:540100},
{SKU:'FLEX-29',category:'فلکسی',name:'۲۹ نمره فلکسی',partner:861800},
{SKU:'FLEX-36',category:'فلکسی',name:'۳۶ نمره فلکسی',partner:1200000}
];

// ساخت قیمت مشتری با ۲۰٪ بیشتر
products=rawProducts.map(p=>({...p,customer:Math.round(p.partner*1.2)}));

const q=byId('q'), filterCat=byId('filterCat'), priceType=byId('priceType'), productsArea=byId('productsArea'), cartList=byId('cartList'), totalEl=byId('total');

rebuildCats(); renderProducts(); renderCart();

function rebuildCats(){
  const cats=Array.from(new Set(products.map(p=>p.category)));
  filterCat.innerHTML='<option value="">همه دسته‌ها</option>'+cats.map(c=>`<option value="${c}">${c}</option>`).join('');
}

function renderProducts(){
  const qv=q.value.trim().toLowerCase();
  const cat=filterCat.value;
  const ptype=priceType.value;
  productsArea.innerHTML='';
  products.forEach((p,idx)=>{
    if(cat && p.category!==cat) return;
    if(qv && !(p.SKU.toLowerCase().includes(qv)||p.name.toLowerCase().includes(qv))) return;
    const price=ptype==='partner'?p.partner:p.customer;
    const div=document.createElement('div'); div.className='product-card';
    div.innerHTML=`<div class="product-name">${p.name}</div>
    <div class="product-brand">${p.brand||'-'}</div>
    <div class="product-category">${p.category}</div>
    <div class="price">${fmt(price)}</div>
    <div style="display:flex;gap:6px;justify-content:flex-end">
      <input data-idx="${idx}" class="qty" type="number" value="1" min="1" style="width:50px;padding:4px;border-radius:6px;border:1px solid #eee"/>
      <button data-idx="${idx}" class="btn addBtn small">افزودن</button>
    </div>`;
    productsArea.appendChild(div);
  });
  document.querySelectorAll('.addBtn').forEach(b=>b.addEventListener('click',onAdd));
}

function onAdd(e){
  const idx=Number(e.currentTarget.dataset.idx);
  const qty=Number(e.currentTarget.closest('.product-card').querySelector('.qty').value)||1;
  const ptype=priceType.value;
  const product=products[idx];
  const unit=ptype==='partner'?product.partner:product.customer;
  addToCart({sku:product.SKU,name:product.name,unit:unit,qty:qty});
}

function addToCart(item){
  const found=cart.find(c=>c.sku===item.sku && c.unit===item.unit);
  if(found) found.qty+=item.qty; else cart.push(item);
  renderCart();
}

function renderCart(){
  cartList.innerHTML='';
  let sum=0;
  cart.forEach((c,i)=>{
    const lineTotal=c.unit*c.qty;
    sum+=lineTotal;
    const div=document.createElement('div'); div.className='cart-row';
    div.innerHTML=`<div style="flex:1"><strong>${c.name}</strong><div class="muted">${c.sku} • ${c.qty} × ${fmt(c.unit)}</div></div>
    <div style="text-align:left"><div>${fmt(lineTotal)}</div>
    <div style="margin-top:6px;display:flex;gap:6px;justify-content:flex-end">
      <button class="btn small" data-i="${i}" data-act="inc">+</button>
      <button class="btn small" data-i="${i}" data-act="dec">-</button>
      <button class="btn small" data-i="${i}" data-act="rem">حذف</button>
    </div></div>`;
    cartList.appendChild(div);
  });
  totalEl.textContent='جمع کل: '+fmt(sum);
  cartList.querySelectorAll('button').forEach(b=>{
    b.addEventListener('click',e=>{
      const i=Number(e.currentTarget.dataset.i),act=e.currentTarget.dataset.act;
      if(act==='inc') cart[i].qty++;
      if(act==='dec') cart[i].qty=Math.max(1,cart[i].qty-1);
      if(act==='rem') cart.splice(i,1);
      renderCart();
    });
  });
}

byId('clearBtn').addEventListener('click',()=>{ q.value=''; filterCat.value=''; priceType.value='partner'; renderProducts(); });
byId('clearCart').addEventListener('click',()=>{ if(confirm('پاک کردن کل سبد؟')){ cart=[]; renderCart(); } });
byId('printBtn').addEventListener('click',()=>{
  const lines=cart.map(c=>`<tr><td>${c.sku}</td><td>${c.name}</td><td>${c.qty}</td><td>${c.unit.toLocaleString('fa-IR')}</td><td>${(c.unit*c.qty).toLocaleString('fa-IR')}</td></tr>`).join('');
  const sum=cart.reduce((s,c)=>s+c.unit*c.qty,0);
  const html=`<!doctype html><html lang="fa"><head><meta charset="utf-8"><title>فاکتور</title>
  <style>body{font-family:Tahoma;direction:rtl;padding:20px}table{width:100%;border-collapse:collapse}td,th{border:1px solid #ddd;padding:8px;text-align:right}</style></head><body>
  <h2>فاکتور — KeePrice</h2><table><thead><tr><th>SKU</th><th>نام کالا</th><th>تعداد</th><th>قیمت واحد</th><th>مبلغ</th></tr></thead><tbody>${lines}</tbody></table>
  <h3 style="text-align:left">جمع کل: ${sum.toLocaleString('fa-IR')} تومان</h3></body></html>`;
  const w=window.open('','_blank'); w.document.write(html); w.document.close();
});

q.addEventListener('input',renderProducts);
filterCat.addEventListener('change',renderProducts);
priceType.addEventListener('change',renderProducts);
})();
</script>
</body>
</html>
