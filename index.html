<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KeePrice — فروشگاه مدرن</title>
<style>
:root{
  --bg:#f0f4f8;
  --card:#ffffff;
  --accent:#0b3d91;
  --accent2:#b7410e;
  --muted:#d0d0d0;
  --text:#111;
}
body{font-family:Tahoma,Arial,sans-serif;direction:rtl;background:var(--bg);margin:0;color:var(--text)}
header{background:linear-gradient(90deg,var(--accent) 0%,#6b9ddb 100%);color:#fff;padding:16px 20px;display:flex;align-items:center;gap:12px}
header h1{margin:0;font-size:20px;font-weight:600}
.container{display:grid;grid-template-columns:1fr 380px;gap:18px;padding:18px}
.card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
.toolbar{display:flex;gap:10px;align-items:center;margin-bottom:16px;flex-wrap:wrap}
input,select,button{font-family:inherit}
input,select{padding:6px 10px;border-radius:6px;border:1px solid #ccc}
button{cursor:pointer}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
.product-card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 4px 12px rgba(0,0,0,0.05);transition:0.2s}
.product-card:hover{box-shadow:0 6px 18px rgba(0,0,0,0.12);transform:translateY(-2px)}
.product-name{font-weight:600;margin:6px 0}
.product-brand{color:var(--muted);font-size:13px}
.product-category{font-size:12px;color:#999}
.price{font-weight:700;color:var(--accent2);margin:8px 0}
.btn{background:var(--accent);color:#fff;border:none;padding:6px 10px;border-radius:6px;transition:0.2s}
.btn:hover{background:var(--accent2)}
.btn.small{padding:4px 8px;font-size:13px}
.cart-list{max-height:420px;overflow:auto}
.cart-row{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #eee}
.total{font-size:18px;font-weight:800;margin-top:12px;color:var(--accent2)}
.sidebar{position:sticky;top:18px;height:fit-content}
.muted{color:var(--muted);font-size:12px}
#modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);justify-content:center;align-items:center}
#modalContent{background:#fff;padding:20px;border-radius:12px;max-width:400px;width:90%;position:relative}
@media(max-width:920px){.container{grid-template-columns:1fr;padding:12px}.sidebar{position:static}}
</style>
</head>
<body>
<header>
<div style="width:44px;height:44px;border-radius:8px;overflow:hidden">
  <img src="https://uploadkon.ir/uploads/76bd07_25photo-2025-10-06-18-29-38-removebg-preview.png" alt="Logo" style="width:100%;height:100%;object-fit:cover">
</div>
<div>
  <h1>KeePrice — فروشگاه مدرن</h1>
  <div class="muted">انتخاب کالا → نوع قیمت → افزودن به سبد</div>
</div>
</header>

<div class="container">
  <main class="card">
    <div class="toolbar">
      <input id="q" placeholder="جستجو نام یا برند">
      <select id="filterCat"><option value="">همه دسته‌ها</option></select>
      <select id="priceType">
        <option value="partner">قیمت همکار</option>
        <option value="customer">قیمت مشتری</option>
      </select>
      <button class="btn small" id="clearBtn">پاک‌سازی</button>
      <button class="btn small" id="showNewProduct">افزودن محصول جدید</button>
    </div>

    <div class="products-grid" id="productsArea"></div>
  </main>

  <aside class="sidebar">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><strong>سبد خرید</strong><div class="muted">آیتم‌های انتخاب‌شده</div></div>
        <div class="tag" style="background:var(--accent2);color:#fff;padding:4px 8px;border-radius:999px;font-size:12px;">KeePrice</div>
      </div>
      <div class="cart-list" id="cartList"></div>
      <div class="total" id="total">جمع کل: 0 تومان</div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" id="printBtn">چاپ / پیش‌نمایش فاکتور</button>
        <button class="btn small" id="clearCart">پاک کردن</button>
      </div>
    </div>
  </aside>
</div>

<!-- پنجره شناور افزودن محصول جدید -->
<div id="modal">
  <div id="modalContent">
    <h3>افزودن محصول جدید</h3>
    <input id="newName" placeholder="نام محصول" style="width:100%;margin-bottom:6px">
    <input id="newSKU" placeholder="SKU" style="width:100%;margin-bottom:6px">
    <input id="newCat" placeholder="دسته" style="width:100%;margin-bottom:6px">
    <input id="newPartner" placeholder="قیمت همکار" type="number" style="width:100%;margin-bottom:6px">
    <input id="newCustomer" placeholder="قیمت مشتری" type="number" style="width:100%;margin-bottom:12px">
    <div style="display:flex;gap:6px;justify-content:flex-end">
      <button class="btn small" id="addNewProduct">افزودن</button>
      <button class="btn small" id="closeModal">لغو</button>
    </div>
  </div>
</div>

<script>
(function(){
let products=[], cart=[];

function fmt(n){ return Number(n).toLocaleString('fa-IR') + ' تومان'; }
function byId(id){ return document.getElementById(id); }

// داده اولیه
const rawProducts=[    
    {SKU:'WDP1O',category:'هارد',name:'هارد بنفش 1 ترابایت اصلی',partner:6700000,customer:1111},
    {SKU:'WDP1',category:'هارد',name:'هارد بنفش 1 ترابایت شرکتی',partner:3900000,customer:1111},
    {SKU:'WDP1.2',category:'هارد',name:'هارد بنفش 1 ترابایت شرکتی در جه 2',partner:3500000,customer:1111},
    {SKU:'WDP2O',category:'هارد',name:'هارد بنفش 2 ترابایت اصلی',partner:8000000,customer:1111},
    {SKU:'WDP2',category:'هارد',name:'هارد بنفش 2 ترابایت شرکتی',partner:6900000,customer:1111},
    {SKU:'WDP2.2',category:'هارد',name:'هارد بنفش 2 ترابایت شرکتی درجه 2',partner:6500000,customer:1111},
    {SKU:'WDP4',category:'هارد',name:'هارد بنفش 4 ترابایت اصلی',partner:11300000,customer:1111},
    {SKU:'SWE8',category:'سوییچ',name:'سوییچ الکاتو 8 پورت معمولی',partner:650000,customer:850000},
    {SKU:'SWE4',category:'سوییچ',name:'سوییچ الکاتو 4 پورت معمولی',partner:480000,customer:600000},
    {SKU:'SWE4POE',category:'سوییچ',name:'سوییچ الکاتو 4 پورت POE',partner:2000000,customer:2800000},
    {SKU:'SWE51000',category:'سوییچ',name:'سوییچ الکاتو 5 پورت1000 بدون POE',partner:900000,customer:1200000},
    {SKU:'SWE4POEE',category:'سوییچ',name:' سوییچ الکاتو 4 پورت اقتصادیPOE',partner:1450000,customer:2200000},
    {SKU:'SWE8POE',category:'سوییچ',name:'سوییچ الکاتو 8 پورت 100POE',partner:2600000,customer:3500000},
    {SKU:'SWE81000',category:'سوییچ',name:'سوییچ الکاتو 8 پورت1000 بدون POE',partner:1350000,customer:1700000},
    {SKU:'SWE81000POE',category:'سوییچ',name:'سوییچ الکاتو 8 پورت1000  POE',partner:3600000,customer:4500000},
    {SKU:'SWE8120POE',category:'سوییچ',name:'سوییچ الکاتو 8 پورت120W  POE',partner:3400000,customer:4500000},
    {SKU:'ADAB2P',category:'آدابتور',name: 'آدابتور 2 آمپر پاور زرد',partner:125000,customer:1111},
    {SKU:'ADAB2PP',category:'آدابتور',name: 'آدابتور 2 آمپر پاور بنفش',partner:130000,customer:1111},
    {SKU:'ADAB2V',category:'آدابتور',name: 'آدابتور 2 آمپر ولت',partner:140000,customer:1111},
    {SKU:'ADAB2L',category:'آدابتور',name: 'آدابتور 2 آمپر لایون',partner:125000,customer:1111},
    {SKU:'ADAB5P',category:'آدابتور',name: 'آدابتور 5 آمپر پاور آبی',partner:250000,customer:1111},
    {SKU:'ADAB5A',category:'آدابتور',name: 'آدابتور 5 آمپرادلای ',partner:280000,customer:1111},
    {SKU:'ADABI5',category:'آدابتور',name: 'آدابتور 5 آمپر صنعتی ',partner:350000,customer:1111},
    {SKU:'ADABI10',category:'آدابتور',name: 'آدابتور 10 آمپر صنعتی ',partner:480000,customer:1111},
    {SKU:'ADABI15',category:'آدابتور',name: 'آدابتور 15 آمپر صنعتی ',partner:540000,customer:1111},
    {SKU:'ADABI20',category:'آدابتور',name: 'آدابتور 20 آمپر صنعتی ',partner:620000,customer:1111},
    {SKU:'ADABI30',category:'آدابتور',name: 'آدابتور 30 آمپر صنعتی ',partner:700000,customer:1111},
    {SKU:'FISHN',category:'آدابتور',name: ' فیش آدابتوری نری ',partner:10000,customer:1111},
    {SKU:'FISHM',category:'آدابتور',name: ' فیش آدابتوری مادگی ',partner:10000,customer:1111},
    {SKU:'KA0796',category:'کابل',name: ' کابل ترکیبی 07/96 برق نیم',partner:16000,customer:1111},
    {SKU:'KA0796M',category:'کابل',name: ' کابل ترکیبی 07/96 مس برق یک',partner:19000,customer:1111},
    {SKU:'KACCA',category:'کابل',name: ' کابل ترکیبی 08/96 CCA برق نیم',partner:14000,customer:1111},
    {SKU:'KAUC',category:'کابل',name: ' کابل شبکه UTP CCA 30M',partner:14000,customer:1111},
    {SKU:'KACU',category:'کابل',name: ' کابل شبکه UTP CU 30M ',partner:22000,customer:1111},
    {SKU:'KASCU',category:'کابل',name: ' کابل شبکه SFTP CU 500M ',partner:27000,customer:1111},
    {SKU:'KAUSO',category:'کابل',name: ' کابل شبکه UTP SFTP OUTDOOR  500M ',partner:35000,customer:1111},
    {SKU:'KAP',category:'کابل',name: ' کابل پاور ',partner:100000,customer:1111},
    {SKU:'KA2D',category:'کابل',name: ' سیم دوزوج ',partner:7000,customer:1111},
    {SKU:'KA0764',category:'کابل',name: ' کابل ترکیبی 07/64 الیاژ ',partner:10000,customer:1111},
    {SKU:'HDMI1',category:'کابل',name: ' HDMI 1/5M ',partner:80000,customer:1111},
    {SKU:'HDMI3',category:'کابل',name: ' HDMI 3M ',partner:130000,customer:1111},
    {SKU:'HDMI5',category:'کابل',name: ' HDMI 5M ',partner:200000,customer:1111},
    {SKU:'HDMI10',category:'کابل',name: ' HDMI 10M ',partner:330000,customer:1111},
    {SKU:'HDMI15',category:'کابل',name: ' HDMI 15M ',partner:480000,customer:1111},
    {SKU:'HDMI20',category:'کابل',name: ' HDMI 20M ',partner:650000,customer:1111},
    {SKU:'HDMI4K',category:'کابل',name: ' HDMI 4K 1/5M ',partner:180000,customer:1111},
    {SKU:'HDMI4K3',category:'کابل',name: ' HDMI 4K 3M ',partner:270000,customer:1111},
    {SKU:'HDMI4K5',category:'کابل',name: ' HDMI 4K 5M ',partner:380000,customer:1111},
    {SKU:'HDMI4K10',category:'کابل',name: ' HDMI 4K 10M ',partner:790000,customer:1111},
    {SKU:'HDMI4K15',category:'کابل',name: ' HDMI 4K 15M ',partner:1200000,customer:1111},
    {SKU:'HDMI4K20',category:'کابل',name: ' HDMI 4K 20M ',partner:1400000,customer:1111},
    {SKU:'MODEMUX400',category:'مودم',name: ' مودم نزتک ux400 ',partner:3400000,customer:1111},
    {SKU:'MODEMUX100',category:'مودم',name: ' مودم نزتک ux100 ',partner:2900000,customer:1111},
    {SKU:'BSTK15',category:'بست',name: ' بست کمربندی 15 ',partner:10000,customer:1111},
    {SKU:'BSTK20',category:'بست',name: ' بست کمربندی 20 ',partner:10000,customer:1111},
    {SKU:'BSTK25',category:'بست',name: ' بست کمربندی 25 ',partner:10000,customer:1111},
    {SKU:'BSTK30',category:'بست',name: ' بست کمربندی 30 ',partner:10000,customer:1111},
    {SKU:'BSTF13',category:'بست',name: ' بست فلکسی 13 ',partner:2000,customer:1111},
    {SKU:'BSTF16',category:'بست',name: ' بست فلکسی 16 ',partner:3000,customer:1111},
    {SKU:'BSTF21',category:'بست',name: ' بست فلکسی 21 ',partner:4000,customer:1111},
    {SKU:'BSTF25',category:'بست',name: ' بست فلکسی 25 ',partner:5000,customer:1111},
    {SKU:'BNCP',category:'برل-BNC',name: ' پیچی معمولی BNC ',partner:15000,customer:1111},
    {SKU:'BNCPP',category:'برل-BNC',name: ' پیچ پرسی BNC ',partner:15000,customer:1111},
    {SKU:'BNCP',category:'برل-BNC',name: ' پیچی ETTO BNC ',partner:22000,customer:1111},
    {SKU:'BNCP',category:'برل-BNC',name: ' پیچ خوب BNC ',partner:17000,customer:1111},
    {SKU:'BRLOUT',category:'برل-BNC',name: ' برل شبکه اوت دور ',partner:15000,customer:1111},
    {SKU:'BRLO',category:'برل-BNC',name: ' برل شبکه اصلی ',partner:15000,customer:1111},
    {SKU:'BRLVG',category:'برل-BNC',name: ' برل VG ',partner:15000,customer:1111},
    {SKU:'BRLHDMI',category:'برل-BNC',name: ' برل HDMI ',partner:15000,customer:1111},
    {SKU:'BRLBNC',category:'برل-BNC',name: ' برل BNC ',partner:15000,customer:1111},
    {SKU:'SUKTETTO',category:'سوکت',name: ' سوکت شبکه میان گذر اتو اصلی ',partner:5000,customer:1111},
    {SKU:'SUKTETTOSFTP',category:'سوکت',name: ' سوکت شبکه ETTO SFTP ',partner:7000,customer:1111},
    {SKU:'SUKTKNETSFTP',category:'سوکت',name: ' سوکت شبکه SFTP K-NET فلزی ',partner:9000,customer:1111},
    {SKU:'SUKTKNET',category:'سوکت',name: ' سوکت شبکه  K-NET  ',partner:6000,customer:1111},
    {SKU:'SUKTACH',category:'سوکت',name: ' آچار شبکه ',partner:220000,customer:1111},
    {SKU:'CAMBOXW13',category:'کمباکس',name: ' کمباکس 13*13 سفید  ',partner:60000,customer:1111},
    {SKU:'CAMBOXG13',category:'کمباکس',name: ' کمباکس 13*13 طوسی  ',partner:60000,customer:1111},
    {SKU:'CAMBOXW15',category:'کمباکس',name: ' کمباکس 15*15 سفید  ',partner:80000,customer:1111},
    {SKU:'CAMBOXG15',category:'کمباکس',name: ' کمباکس 15*15 طوسی  ',partner:80000,customer:1111},
    {SKU:'CAMBOXlola14',category:'کمباکس',name: ' کمباکس 14*14 لولایی  ',partner:80000,customer:1111},
    {SKU:'CAMBOXPL',category:'کمباکس',name: ' کمباکس پرو ال   ',partner:120000,customer:1111},
    {SKU:'CAMBOX360',category:'کمباکس',name: ' کمباکس 360  ',partner:90000,customer:1111},
    {SKU:'CAMBOXSYCLE',category:'کمباکس',name: ' کمباکس گرد  ',partner:60000,customer:1111},
    {SKU:'CAMBOXW16',category:'کمباکس',name: ' کمباکس 16*16 سفید  ',partner:90000,customer:1111},
    {SKU:'CAMBOXG16',category:'کمباکس',name: ' کمباکس 16*16 طوسی  ',partner:90000,customer:1111},
    {SKU:'CAMBOXFIXL',category:'کمباکس',name: ' کمباکس فیکس ال  ',partner:60000,customer:1111},
    {SKU:'EXHDMI30',category:'اکستندر',name: ' اکستندر HDMI 30M ',partner:250000,customer:1111},
    {SKU:'EXHDMI60',category:'اکستندر',name: ' اکستندر HDMI 60M ',partner:2300000,customer:1111},
    {SKU:'EXHDMIUSB60',category:'اکستندر',name: ' اکستندر HDMI 60M + USB ',partner:3300000,customer:1111},
    {SKU:'EXUSBK60',category:'اکستندر',name: ' اکستندر USB 60M K-NET ',partner:890000,customer:1111},
    {SKU:'EXUSB60',category:'اکستندر',name: ' اکستندر USB 60M ',partner:380000,customer:1111},
    {SKU:'POWER4',category:'محافظ برق',name: ' سیار 4 خانه ',partner:250000,customer:1111},
    {SKU:'POWER2',category:'محافظ برق',name: ' دوشاخه برق',partner:30000,customer:1111},
    {SKU:'POWERM',category:'محافظ برق',name: ' مادگی برق ',partner:30000,customer:1111},
    {SKU:'POWER23',category:'محافظ برق',name: ' تبدیل 3به 2 برق ',partner:50000,customer:1111},
    {SKU:'POWER3',category:'محافظ برق',name: ' سه راه توپی ',partner:250000,customer:1111},
    {SKU:'VGA1',category:' کابل ',name: ' کابل VGA 1/5  متری ',partner:70000,customer:1111},
    {SKU:'VGA3',category:' کابل ',name: ' کابل VGA 3  متری ',partner:120000,customer:1111},
    {SKU:'VGA5',category:' کابل ',name: ' کابل VGA 5  متری ',partner:160000,customer:1111},
    {SKU:'VGA10',category:' کابل ',name: ' کابل VGA 10  متری ',partner:330000,customer:1111},
    {SKU:'VGA15',category:' کابل ',name: ' کابل VGA 15  متری ',partner:420000,customer:1111},
    {SKU:'VGA20',category:' کابل ',name: ' کابل VGA 20  متری ',partner:520000,customer:1111},
    {SKU:'USB1',category:' کابل ',name: ' کابل USB 1/5  متری ',partner:55000,customer:1111},
    {SKU:'USB3',category:' کابل ',name: ' کابل USB 3  متری ',partner:90000,customer:1111},
    {SKU:'USB5',category:' کابل ',name: ' کابل USB 5  متری ',partner:120000,customer:1111},
    {SKU:'USB10',category:' کابل ',name: ' کابل USB 10  متری ',partner:280000,customer:1111},
    {SKU:'USB15',category:' کابل ',name: ' کابل USB 15  متری ',partner:590000,customer:1111},
    {SKU:'USB20',category:' کابل ',name: ' کابل USB 20  متری ',partner:690000,customer:1111},
    {SKU:'BACH1',category:' کابل ',name: ' کابل بچکرد 1  متری ',partner:40000,customer:1111},
    {SKU:'BACH2',category:' کابل ',name: ' کابل بچکرد 2  متری ',partner:50000,customer:1111},
    {SKU:'BACH3',category:' کابل ',name: ' کابل بچکرد 3  متری ',partner:60000,customer:1111},
    {SKU:'BACH5',category:' کابل ',name: ' کابل بچکرد 5  متری ',partner:90000,customer:1111},
    {SKU:'BACH10',category:' کابل ',name: ' کابل بچکرد 10  متری ',partner:120000,customer:1111},
    {SKU:'BACH15',category:' کابل ',name: ' کابل بچکرد 15  متری ',partner:190000,customer:1111},
    {SKU:'BACH20',category:' کابل ',name: ' کابل بچکرد 20  متری ',partner:240000,customer:1111},
    {SKU:'BACH30',category:' کابل ',name: ' کابل بچکرد 30  متری ',partner:350000,customer:1111},
    {SKU:'FLAX11',category:' فلکسی ',name: ' فلکسی نمره 11 ',partner:19500,customer:1111},
    {SKU:'FLAX13',category:' فلکسی ',name: ' فلکسی نمره 13 ',partner:21500,customer:1111},
    {SKU:'FLAX16',category:' فلکسی ',name: ' فلکسی نمره 16 ',partner:26000,customer:1111},
    {SKU:'FLAX21',category:' فلکسی ',name: ' فلکسی نمره 21 ',partner:32500,customer:1111},
    {SKU:'FLAX25',category:' فلکسی ',name: ' فلکسی نمره 25 ',partner:47000,customer:1111},
    {SKU:'FLAX29',category:' فلکسی ',name: ' فلکسی نمره 29 ',partner:55000,customer:1111},
    {SKU:'FLAX36',category:' فلکسی ',name: ' فلکسی نمره 36 ',partner:87000,customer:1111},
    {SKU:'PFLAX13',category:' فلکسی ',name: 'پلی فلکسی نمره 13 ',partner:11500,customer:1111},
    {SKU:'PFLAX16',category:' فلکسی ',name: ' پلی فلکسی نمره 16 ',partner:13000,customer:1111},
    {SKU:'PFLAX21',category:' فلکسی ',name: ' پلی فلکسی نمره 21 ',partner:18000,customer:1111},
    {SKU:'PFLAX25',category:' فلکسی ',name: ' پلی فلکسی نمره 25 ',partner:26000,customer:1111},
    {SKU:'PFLAX29',category:' فلکسی ',name: 'پلی فلکسی نمره 29 ',partner:35000,customer:1111},
    {SKU:'DOCT',category:' داکت ',name: ' داکت نمره 1 ',partner:1111,customer:1111},
    {SKU:'DOCT1',category:' داکت ',name: ' داکت نمره 1/5 ',partner:1111,customer:1111},
    {SKU:'DOCT2',category:' داکت ',name: ' داکت نمره 2 ',partner:1111,customer:1111},
    {SKU:'DOCT2.5',category:' داکت ',name: ' داکت نمره 2/5 ',partner:1111,customer:1111},
    {SKU:'DOCT3',category:' داکت ',name: ' داکت نمره 3 ',partner:1111,customer:1111},
    {SKU:'DOCT4',category:' داکت ',name: ' داکت نمره 4 ',partner:1111,customer:1111},
    {SKU:'DOCT5',category:' داکت ',name: ' داکت نمره 5 ',partner:1111,customer:1111},
    {SKU:'DOCT6',category:' داکت ',name: ' داکت نمره 6 ',partner:1111,customer:1111},
    {SKU:'DOCTCH',category:' داکت ',name: ' داکت  چسبی نمره 1 ',partner:1111,customer:1111},
    {SKU:'DOCTCH1',category:' داکت ',name: ' 1/5 ',partner:1111,customer:1111},
    {SKU:'DOCTCH2',category:' داکت ',name: ' داکت  چسبی نمره 2 ',partner:1111,customer:1111},
    {SKU:'DOCTCH2.5',category:' داکت ',name: ' داکت  چسبی نمره 2/5 ',partner:1111,customer:1111},
    {SKU:'DOCTCH3',category:' داکت ',name: ' داکت  چسبی نمره 3 ',partner:1111,customer:1111},
    {SKU:'DOCTCH4',category:' داکت ',name: ' داکت  چسبی نمره 4 ',partner:1111,customer:1111},
    {SKU:'RAK4',category:' رک ',name: ' رک 4 یونیت سپکو  ',partner:1111,customer:1111},
    {SKU:'RAK6',category:' رک ',name: ' رک 6 یونیت   ',partner:1111,customer:1111},
    {SKU:'RAK7',category:' رک ',name: ' رک 7 یونیت   ',partner:1111,customer:1111},
    {SKU:'ANIKA670',category:' دزدگیر ',name: ' دزدگیر A670  ',partner:10000000,customer:1111},
    {SKU:'ANIKA470',category:' دزدگیر ',name: ' دزدگیر A470  ',partner:8500000,customer:1111},
    {SKU:'ANIKA570',category:' دزدگیر ',name: ' دزدگیر A570  ',partner:9000000,customer:1111},
    {SKU:'ANIKA480',category:' دزدگیر ',name: ' دزدگیر A480  ',partner:9400000,customer:1111},
    {SKU:'ANIKECO4000',category:' دزدگیر ',name: ' دزدگیر ECO4000  ',partner:7700000,customer:1111},
    {SKU:'ANIKECOMAX',category:' دزدگیر ',name: ' دزدگیر ECOMAX  ',partner:6900000,customer:1111},
    {SKU:'ANIKECOMAXN',category:' دزدگیر ',name: ' دزدگیر ECOMAX-N  ',partner:6300000,customer:1111},
    {SKU:'ANIKA270',category:' دزدگیر ',name: ' دزدگیر A270  ',partner:4200000,customer:1111},
    {SKU:'ANIKA370',category:' دزدگیر ',name: ' دزدگیر A370  ',partner:6200000,customer:1111},
    {SKU:'GL150',category:' دزدگیر ',name: ' تلفن کننده ی دوگانه GL150 ',partner:4900000,customer:1111},
    {SKU:'L50',category:' دزدگیر ',name: ' تلفن کننده ی خط ثابت L50 ',partner:3200000,customer:1111},
    {SKU:'P1',category:' چشمی ',name: ' چشمی P1  ',partner:890000,customer:1111},
    {SKU:'P2',category:' چشمی ',name: ' چشمی P2  ',partner:700000,customer:1111},
    {SKU:'P3',category:' چشمی ',name: ' چشمی P3  ',partner:640000,customer:1111},
    {SKU:'WP1',category:' چشمی ',name: ' چشمی WP1  ',partner:950000,customer:1111},
    {SKU:'DPA32',category:' چشمی ',name: ' چشمی DP-A32  ',partner:1600000,customer:1111},
    {SKU:'BP',category:' بلند گو ',name: ' آژیر پیزو داخلی  ',partner:120000,customer:1111},
    {SKU:'BSHA',category:' بلند گو ',name: ' بلند گوی شیپوری آنیک  ',partner:340000,customer:1111},
    {SKU:'BSH',category:' بلند گو ',name: ' بلند گوی شیپوری ساده  ',partner:300000,customer:1111},
    {SKU:'BKP',category:' بلند گو ',name: ' کاور بلندگو پلاستیکی ',partner:130000,customer:1111},
    {SKU:'BK',category:' بلند گو ',name: ' کاور بلندگو فلزی ',partner:180000,customer:1111},
    {SKU:'SIDEAC300P',category:'جک و کرکره ',name: ' موتور ساید AC300 پاور ',partner:5000000,customer:7200000},
    {SKU:'SIDEAC600P',category:'جک و کرکره ',name: ' موتور ساید AC600 پاور ',partner:5500000,customer:7700000},
    {SKU:'SIDEAC300R',category:'جک و کرکره ',name: ' موتور ساید AC300 روبوست ',partner:5300000,customer:7500000},
    {SKU:'SIDEAC600R',category:'جک و کرکره ',name: ' موتور ساید AC600 روبوست ',partner:5800000,customer:9000000},
    {SKU:'JACK400K',category:'جک و کرکره ',name: ' جک کیپر 400 ',partner:13200000,customer:26000000},
    {SKU:'JACK600K',category:'جک و کرکره ',name: ' جک کیپر 600 ',partner:14000000,customer:27000000},
    {SKU:'CHATAY',category:'چشمی ',name: ' چشمی آتای ',partner:600000,customer:1400000},
    {SKU:'BORDJACK220W',category:'جک و کرکره ',name: ' برد جک 220 ولت ',partner:1500000,customer:2700000},
    {SKU:'BORDSIDE',category:'جک و کرکره ',name: ' برد موتور ساید',partner:600000,customer:1400000},
    {SKU:'BORDTOPLA',category:'جک و کرکره ',name: ' برد توپلار ',partner:500000,customer:1400000},
    {SKU:'SIDEACOVER',category:'جک و کرکره ',name: ' کاور موتور ساید ',partner:250000,customer:700000},
    {SKU:'BRAKS20',category:' براکت ',name: ' براکت صاف 20 ',partner:165000,customer:200000},
    {SKU:'BRAKS30',category:' براکت ',name: ' براکت صاف 30 ',partner:200000,customer:240000},
    {SKU:'BRAKS40',category:' براکت ',name: ' براکت صاف 40 ',partner:236000,customer:290000},
    {SKU:'BRAKS50',category:' براکت ',name: ' براکت صاف 50 ',partner:265000,customer:320000},
    {SKU:'BRAKS60',category:' براکت ',name: ' براکت صاف 60 ',partner:299000,customer:360000},
    {SKU:'BRAKS70',category:' براکت ',name: ' براکت صاف 70 ',partner:334000,customer:400000},
    {SKU:'BRAKS80',category:' براکت ',name: ' براکت صاف 80 ',partner:368000,customer:440000},
    {SKU:'BRAKS90',category:' براکت ',name: ' براکت صاف 90 ',partner:403000,customer:480000},
    {SKU:'BRAKS100',category:' براکت ',name: ' براکت صاف 100 ',partner:431000,customer:515000},
    {SKU:'BRAKH20',category:' براکت ',name: ' براکت  خم 20 ',partner:178000,customer:220000},
    {SKU:'BRAKH30',category:' براکت ',name: ' براکت  خم 30 ',partner:213000,customer:260000},
    {SKU:'BRAKH40',category:' براکت ',name: ' براکت  خم 40 ',partner:255000,customer:300000},
    {SKU:'BRAKH50',category:' براکت ',name: ' براکت  خم 50 ',partner:288000,customer:340000},
    {SKU:'BRAKH60',category:' براکت ',name: ' براکت  خم 60 ',partner:316000,customer:380000},
    {SKU:'BRAKH70',category:' براکت ',name: ' براکت  خم 70 ',partner:351000,customer:420000},
    {SKU:'BRAKH80',category:' براکت ',name: ' براکت  خم 80 ',partner:390000,customer:460000},
    {SKU:'BRAKH90',category:' براکت ',name: ' براکت  خم 90 ',partner:420000,customer:500000},
    {SKU:'BRAKH100',category:' براکت ',name: ' براکت  خم 100 ',partner:450000,customer:540000},
    {SKU:'BRAK2UP',category:' براکت ',name: ' براکت دو شاخه بالا ',partner:817000,customer:970000},
    {SKU:'BRAK2DOWN ',category:' براکت ',name: ' براکت دو شاخه پایین ',partner:817000,customer:970000},
    {SKU:'BRAK2OF',category:' براکت ',name: ' براکت دو شاخه افقی ',partner:817000,customer:970000},
    {SKU:'BRAK3UP',category:' براکت ',name: ' براکت سه شاخه بالا ',partner:960000,customer:1130000},
    {SKU:'BRAK3OF',category:' براکت ',name: ' براکت سه شاخه افقی ',partner:960000,customer:1130000},
    {SKU:'BRAKL5070',category:' براکت ',name: ' براکت ال 50* 70 ',partner:520000,customer:615000},
    {SKU:'BRAKL6090',category:' براکت ',name: ' براکت ال 60*90 ',partner:630000,customer:740000},
    {SKU:'BRAKL60120',category:' براکت ',name: ' براکت ال 60*120 ',partner:960000,customer:1130000},
    {SKU:'BRAKL60150',category:' براکت ',name: ' براکت ال 60*150 ',partner:1070000,customer:1270000},
    {SKU:'PAYEHS',category:' براکت ',name: ' پایه ثابت ',partner:350000,customer:415000},
    { SKU: 'UVC-212T43P-M/2', category: 'دوربین', name: 'UVC-212T43P-M/2', partner: 5000000, customer: 11600000 },
    { SKU: 'UVC-221B59M/1', category: 'دوربین', name: 'UVC-221B59M/1', partner: 5625000, customer: 18500000 },
    { SKU: 'UVC-85C29', category: 'دوربین', name: 'UVC-85C29', partner: 8125000, customer: 22800000 },
    { SKU: 'UVC-101B1AR-L', category: 'دوربین', name: 'UVC-101B1AR-L', partner: 5400000, customer: 13900000 },
    { SKU: 'UVC-231B1AR-L/4', category: 'دوربین', name: 'UVC-231B1AR-L/4', partner: 4375000, customer: 13900000 },
    { SKU: 'UVC-212T45P-MC/2', category: 'دوربین', name: 'UVC-212T45P-MC/2', partner: 9500000, customer: 14900000 },
    { SKU: 'UVC-211B19P-C/5', category: 'دوربین', name: 'UVC-211B19P-C/5', partner: 8900000, customer: 13300000 },
    { SKU: 'UVC-211B19M-C/5', category: 'دوربین', name: 'UVC-211B19M-C/5', partner: 11400000, customer: 16700000 },
    { SKU: 'UVC-232B1AR-MC/2', category: 'دوربین', name: 'UVC-232B1AR-MC/2', partner: 12600000, customer: 20300000 },
    { SKU: 'UVC-232T9AR-MC/2', category: 'دوربین', name: 'UVC-232T9AR-MC/2', partner: 14000000, customer: 21100000 },
    { SKU: 'UVC-222B49M-MC/2', category: 'دوربین', name: 'UVC-222B49M-MC/2', partner: 14000000, customer: 21300000 },
    { SKU: 'UVC-232B59R-MC/2', category: 'دوربین', name: 'UVC-232B59R-MC/2', partner: 14400000, customer: 21800000 },
    { SKU: 'UVC-232B1AM-MU/2', category: 'دوربین', name: 'UVC-232B1AM-MU/2', partner: 14600000, customer: 25000000 },
    { SKU: 'UVC-83T02', category: 'دوربین', name: 'UVC-83T02', partner: 5625000, customer: 11900000 },
    { SKU: 'UVC-511T02P/3', category: 'دوربین', name: 'UVC-511T02P/3', partner: 5625000, customer: 11900000 },
    { SKU: 'UVC-522B59M/1', category: 'دوربین', name: 'UVC-522B59M/1', partner: 8125000, customer: 24900000 },
    { SKU: 'UVC-522B59M-M/1', category: 'دوربین', name: 'UVC-522B59M-M/1', partner: 8125000, customer: 26200000 },
    { SKU: 'UVC-532C59M-M', category: 'دوربین', name: 'UVC-532C59M-M', partner: 28000000, customer: 43000000 },
    { SKU: 'UVC-532U9EM-M', category: 'دوربین', name: 'UVC-532U9EM-M', partner: 28000000, customer: 43000000 },
    { SKU: 'UVC-511T45P-MC', category: 'دوربین', name: 'UVC-511T45P-MC', partner: 13800000, customer: 20800000 },
    { SKU: 'UVC-512B19M-C/1', category: 'دوربین', name: 'UVC-512B19M-C/1', partner: 16300000, customer: 25200000 },
    { SKU: 'UVC-511B19M-MC', category: 'دوربین', name: 'UVC-511B19M-MC', partner: 16500000, customer: 25600000 },
    { SKU: 'UVC-532B40M-MC', category: 'دوربین', name: 'UVC-532B40M-MC', partner: 17100000, customer: 27200000 },
    { SKU: 'UVC-532B59R-MC/1', category: 'دوربین', name: 'UVC-532B59R-MC/1', partner: 18100000, customer: 28900000 },
    { SKU: 'UVC-521B49M-MPC/4', category: 'دوربین', name: 'UVC-521B49M-MPC/4', partner: 20000000, customer: 28600000 },
    { SKU: 'UVR-A04EM-D74G', category: 'دوربین', name: 'UVR-A04EM-D74G', partner: 23900000, customer: 36300000 },
    { SKU: 'UVR-A08EM-D78G', category: 'دوربین', name: 'UVR-A08EM-D78G', partner: 30000000, customer: 46300000 },
    { SKU: 'UVR-7TCA16AM-D5C6', category: 'دوربین', name: 'UVR-7TCA16AM-D5C6', partner: 39500000, customer: 78600000 },
    { SKU: 'UVR-7TAA04HX-D54G', category: 'دوربین', name: 'UVR-7TAA04HX-D54G', partner: 27500000, customer: 42700000 },
    { SKU: 'UVR-7TCA08HX-D58G', category: 'دوربین', name: 'UVR-7TCA08HX-D58G', partner: 45200000, customer: 74000000 },
    { SKU: 'UVR-B04EHB-D78J', category: 'دوربین', name: 'UVR-B04EHB-D78J', partner: 29100000, customer: 41500000 },
    { SKU: 'UVR-B08EHB-D78J', category: 'دوربین', name: 'UVR-B08EHB-D78J', partner: 34900000, customer: 49900000 },
    { SKU: 'UVR-F16EHB-D7C6', category: 'دوربین', name: 'UVR-F16EHB-D7C6', partner: 43000000, customer: 70500000 },
    { SKU: 'UVR-7THB16H-D5C8', category: 'دوربین', name: 'UVR-7THB16H-D5C8', partner: 89900000, customer: 141900000 },
    { SKU: 'UVR-7THB16H-G1C5', category: 'دوربین', name: 'UVR-7THB16H-G1C5', partner: 99750000, customer: 157500000 },
    { SKU: 'UVR-7TAA04AH-D14G', category: 'دوربین', name: 'UVR-7TAA04AH-D14G', partner: 44300000, customer: 63300000 },
    { SKU: 'UVR-7TAB08AH-D18A', category: 'دوربین', name: 'UVR-7TAB08AH-D18A', partner: 61000000, customer: 89400000 },
    { SKU: 'UVR-7TCG16AH-G1C5', category: 'دوربین', name: 'UVR-7TCG16AH-G1C5', partner: 113000000, customer: 165700000 },
    { SKU: 'UVR-7TCA04RQ-D149', category: 'دوربین', name: 'UVR-7TCA04RQ-D149', partner: 57000000, customer: 79500000 },
    { SKU: 'UVR-7TCG08RQ-D189', category: 'دوربین', name: 'UVR-7TCG08RQ-D189', partner: 90600000, customer: 126500000 },
    { SKU: 'UVR-7TCG08RQ-G181', category: 'دوربین', name: 'UVR-7TCG08RQ-G181', partner: 102480000, customer: 143000000 },
    { SKU: 'IOT-72P8/4', category: 'دوربین', name: 'IOT-72P8/4', partner: 22100000, customer: 25900000 },
    { SKU: 'IOT-72B72-TMSC', category: 'دوربین', name: 'IOT-72B72-TMSC', partner: 30900000, customer: 38000000 },
    { SKU: 'IOT-74P8M/1', category: 'دوربین', name: 'IOT-74P8M/1', partner: 25100000, customer: 33400000 },
    { SKU: 'IOT-65P12M-TMSU', category: 'دوربین', name: 'IOT-65P12M-TMSU', partner: 33900000, customer: 45200000 }
  

];

// اضافه کردن محصول جدید به لیست محصولات
products = [...rawProducts, {SKU:'PAYEHS',category:' براکت ',name: ' پایه ثابت ',partner:350000,customer:415000}];

const q = byId('q'), filterCat = byId('filterCat'), priceType = byId('priceType'), productsArea = byId('productsArea'), cartList = byId('cartList'), totalEl = byId('total');
const modal = byId('modal');

rebuildCats(); renderProducts(); renderCart();

// دسته‌بندی
function rebuildCats(){
  const cats = Array.from(new Set(products.map(p => p.category)));
  filterCat.innerHTML = '<option value="">همه دسته‌ها</option>' + cats.map(c => `<option value="${c}">${c}</option>`).join('');
}

// نمایش محصولات با امکان قیمت دلخواه
function renderProducts(){
  const qv = q.value.trim().toLowerCase();
  const cat = filterCat.value;
  const ptype = priceType.value;
  productsArea.innerHTML = '';
  products.forEach((p, idx) => {
    if(cat && p.category !== cat) return;
    if(qv && !(p.SKU.toLowerCase().includes(qv) || p.name.toLowerCase().includes(qv))) return;
    const price = ptype === 'partner' ? p.partner : p.customer;
    const div = document.createElement('div'); div.className = 'product-card';
    div.innerHTML = `<div class="product-name">${p.name}</div>
    <div class="product-brand">${p.brand || '-'}</div>
    <div class="product-category">${p.category}</div>
    <div class="price"><input type="number" class="customPrice" value="${price}" style="width:100%;padding:4px;border-radius:6px;border:1px solid #ccc"></div>
    <div style="display:flex;gap:6px;justify-content:flex-end">
      <input data-idx="${idx}" class="qty" type="number" value="1" min="1" style="width:50px;padding:4px;border-radius:6px;border:1px solid #eee"/>
      <button data-idx="${idx}" class="btn addBtn small">افزودن</button>
    </div>`;
    productsArea.appendChild(div);
  });
  document.querySelectorAll('.addBtn').forEach(b => b.addEventListener('click', onAdd));
}

// افزودن به سبد با قیمت دلخواه
function onAdd(e){
  const card = e.currentTarget.closest('.product-card');
  const idx = Number(e.currentTarget.dataset.idx);
  const qty = Number(card.querySelector('.qty').value) || 1;
  const custom = Number(card.querySelector('.customPrice').value);
  if(custom <= 0){ alert('قیمت معتبر نیست'); return; }
  const product = products[idx];
  addToCart({sku: product.SKU, name: product.name, unit: custom, qty: qty});
}

function addToCart(item){
  const found = cart.find(c => c.sku === item.sku && c.unit === item.unit);
  if(found) found.qty += item.qty; else cart.push(item);
  renderCart();
}

// نمایش سبد
function renderCart(){
  cartList.innerHTML = '';
  let sum = 0;
  cart.forEach((c, i) => {
    const lineTotal = c.unit * c.qty;
    sum += lineTotal;
    const div = document.createElement('div'); div.className = 'cart-row';
    div.innerHTML = `<div style="flex:1"><strong>${c.name}</strong><div class="muted">${c.sku} • ${c.qty} × ${fmt(c.unit)}</div></div>
    <div style="text-align:left"><div>${fmt(lineTotal)}</div>
    <div style="margin-top:6px;display:flex;gap:6px;justify-content:flex-end">
      <button class="btn small" data-i="${i}" data-act="inc">+</button>
      <button class="btn small" data-i="${i}" data-act="dec">-</button>
      <button class="btn small" data-i="${i}" data-act="rem">حذف</button>
    </div></div>`;
    cartList.appendChild(div);
  });
  totalEl.textContent = 'جمع کل: ' + fmt(sum);
  cartList.querySelectorAll('button').forEach(b => {
    b.addEventListener('click', e => {
      const i = Number(e.currentTarget.dataset.i), act = e.currentTarget.dataset.act;
      if(act === 'inc') cart[i].qty++;
      if(act === 'dec') cart[i].qty = Math.max(1, cart[i].qty - 1);
      if(act === 'rem') cart.splice(i, 1);
      renderCart();
    });
  });
}

// دکمه‌ها
byId('clearBtn').addEventListener('click', () => { q.value = ''; filterCat.value = ''; priceType.value = 'partner'; renderProducts(); });
byId('clearCart').addEventListener('click', () => { if(confirm('پاک کردن کل سبد؟')){ cart = []; renderCart(); } });
byId('printBtn').addEventListener('click', () => {
  const lines = cart.map(c => `<tr><td>${c.sku}</td><td>${c.name}</td><td>${c.qty}</td><td>${(c.unit).toLocaleString('fa-IR')}</td><td>${(c.unit * c.qty).toLocaleString('fa-IR')}</td></tr>`).join('');
  const sum = cart.reduce((s, c) => s + c.unit * c.qty, 0);
  const html = `<!doctype html><html lang="fa"><head><meta charset="utf-8"><title>فاکتور</title>
  <style>body{font-family:Tahoma;direction:rtl;padding:20px}table{width:100%;border-collapse:collapse}td,th{border:1px solid #ddd;padding:8px;text-align:right}</style></head><body>
  <h2>فاکتور — KeePrice</h2><table><thead><tr><th>SKU</th><th>نام کالا</th><th>تعداد</th><th>قیمت واحد</th><th>مبلغ</th></tr></thead><tbody>${lines}</tbody></table>
  <h3 style="text-align:left">جمع کل: ${sum.toLocaleString('fa-IR')} تومان</h3></body></html>`;
  const w = window.open('', '_blank'); w.document.write(html); w.document.close();
});

q.addEventListener('input', renderProducts);
filterCat.addEventListener('change', renderProducts);
priceType.addEventListener('change', renderProducts);

// پنجره شناور
byId('showNewProduct').addEventListener('click', () => { modal.style.display = 'flex'; });
byId('closeModal').addEventListener('click', () => { modal.style.display = 'none'; });

// افزودن محصول جدید
byId('addNewProduct').addEventListener('click', () => {
  const name = byId('newName').value.trim();
  const SKU = byId('newSKU').value.trim();
  const category = byId('newCat').value.trim();
  const partner = Number(byId('newPartner').value);
  const customer = Number(byId('newCustomer').value);
  if(!name || !SKU || !category || !partner || !customer){ alert('لطفاً همه فیلدها را پر کنید'); return; }
  products.push({SKU, name, category, partner, customer});
  rebuildCats(); renderProducts();
  modal.style.display = 'none';
  byId('newName').value = ''; byId('newSKU').value = ''; byId('newCat').value = ''; byId('newPartner').value = ''; byId('newCustomer').value = '';
});
})();
</script>
</body>
</html>
